<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <!-- <link rel="stylesheet" href="https://fonts.google.com/icons?selected=Material+Icons"> -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <title>Speechbert</title>
</head>
<body>
    <h1>Speechbert</h1>
    <!-- Contains the whole PLayer -->
    <div class="audio-container">
        <div class="music-info">
            <h4 id="title">'Bitte wählen Sie einen Feed'</h4> 
            <!-- <div class="progress-container">
                <div class="progress"></div>
            </div> -->
        </div>
        <audio src="https://zon-speechbert-production.s3.eu-central-1.amazonaws.…b66458d95280af6aa3f4aab730d6db0ea4bab44bf086a41fb6c6edc2.mp3" id="speechbertAudio"></audio>
        <div class="navigation">
            <div class="prev" id="action-btn">
                <span class="material-icons">skip_previous</span>
            </div>
            <div class="play" id="action-btn">
                <span class="material-icons">play_arrow</span>
            </div>
            <div class="next" id="action-btn">
                <span class="material-icons">skip_next</span>
            </div>
        </div>
    </div>
        
    <script>
        const api_url = 'https://speech.zeit.de/api/feeds/playlist/neue-nachrichten-test'
        
        // Initiate Arrays for AudioFeed titles and urls
        let audioFeedTitles = []
        let audioFeedUrls = []

        async function getAudio(){
        const response = await fetch(api_url);  
        const data = await response.json();
        
            // deconstruct JSON response from API to get feed-title and feed-Url
            data.blocks.forEach(element => {
            // const {uuid, title, thumbnail, skippable, items} = element
            let categoryTitle = element.title
            let feeds = element.items[0]
            // console.log(Object.keys(feeds))
            const {uuid, title, description, supertitle, webUrl, image, url, type} = feeds
            // console.log(title)
            // console.log(url)
            audioFeedTitles.push(title);
            audioFeedUrls.push(url);
            });

        // let speechBert = document.getElementById('speechbertAudio').scr += `bitte wählen Sie einen Feed`
        }

        getAudio();

        const audioContainer = document.querySelector('.audio-container');
        const prevBtn = document.querySelector('.prev');
        const playBtn = document.querySelector('.play');
        const nextBtn = document.querySelector('.next');
        const audio = document.querySelector('#speechbertAudio');
        const progress = document.querySelector('.progress');
        const progressContainer = document.querySelector('.progress-container');
        const title = document.querySelector('#title');

        // don't loose at which audioFeed I'm at
        let audioFeedIndex = 0
    
        // load the audioFeed into DOM
        loadAudioFeed(audioFeedTitles[audioFeedIndex], audioFeedUrls[audioFeedIndex] ); 

        // update audio Player Details
        function loadAudioFeed(currentTitle = "Bitte drücken Sie den >Weiter-Button<", currentUrl){
            title.innerText = currentTitle;
            // title.innerText ? "Bitte >weiter-Button< drücken" : currentTitle
            audio.src = currentUrl;
        }

        function playFeed(){
            audioContainer.classList.add('play')
            // span = playBtn.firstChild;
            // txt = document.createTextNode('play_arrow');
            // span.appendChild(txt)

            // playBtn.firstChild.classList.add('material-icons');
            // playBtn.firstChild.classList.remove('material-icons-outlined')

            // playBtn.firstChild.textContent = 'pause';
            audio.play();
        }

        function pauseFeed(){
            audioContainer.classList.remove('play');
            // playBtn.firstChild.classList.remove('material-icons');
            // playBtn.firstChild.classList.add('material-icons-outlined')

            // playBtn.firstChild.textContent = 'pause';
            // playBtn.firstChild.createTextNode('pause');
            // span = playBtn.firstChild;
            // txt = document.createTextNode('pause');
            // span.appendChild(txt)
            audio.pause();
        }
        
        function prevAudioFeed(){
            audioFeedIndex--

            if(audioFeedIndex < 0){
                audioFeedIndex = audioFeedUrls.length -1;
            }
            
            loadAudioFeed(audioFeedTitles[audioFeedIndex], audioFeedUrls[audioFeedIndex] ); 
            playFeed();
        }

        function nextAudioFeed(){
            audioFeedIndex++

            if(audioFeedIndex > audioFeedUrls.length -1 ){
                audioFeedIndex = 0;
            }
            
            loadAudioFeed(audioFeedTitles[audioFeedIndex], audioFeedUrls[audioFeedIndex] ); 
            playFeed();
        }




        // event Listeners
        playBtn.addEventListener('click', () => {
            const isPLaying = audioContainer.classList.contains('play')

            if(isPLaying){
                pauseFeed();
            } else {
                playFeed();
            }
        })

        // change audioFeed events
        prevBtn.addEventListener('click', prevAudioFeed);
        nextBtn.addEventListener('click', nextAudioFeed);


        

    </script>
</body>
</html>